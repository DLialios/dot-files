#!/bin/bash

[ $# -eq 0 ] && exit 1

s=$(nvidia-settings -q [SCREEN-0]/CurrentMetaMode -t)
s=${s#*:: }

if [ $1 = 'off' ]; then

    s=${s/\}/, ForceCompositionPipeline=On\}}

    picom &
    nvidia-settings -a [SCREEN-0]/CurrentMetaMode="$s"
    nvidia-settings -a [SCREEN-0]/ShowVRRVisualIndicator=0

else

    s=${s/ForceCompositionPipeline=On/ForceCompositionPipeline=Off}

    killall picom
    nvidia-settings -a [SCREEN-0]/CurrentMetaMode="$s"
    nvidia-settings -a [SCREEN-0]/ShowVRRVisualIndicator=1

fi
